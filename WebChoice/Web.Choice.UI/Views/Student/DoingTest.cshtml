@using Web.Choice.UI.Models
@{
    var list = Model as List<StudentQuestViewModel>;
    ViewBag.Title = "Làm Bài Thi " + list.First().Test.TestCode;
    Layout = "~/Views/Shared/_LayoutGeneral.cshtml";
}
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    processEscapes: true
    }
    });
</script>
<div class="title-content">
    <span class="title" style="padding-left: 115px;">@ViewBag.Title</span>
    <span id="timer" class="timer timer-fixed">@ViewBag.min : @ViewBag.sec</span>
</div>
<div class="content row col s12 reset-margin" style="padding:0;">
    <div class="testing-left scrollbar">
        @{
            int i = 1;
            foreach (var item in list)
            {
                if (item.StudentTestDetail.StudentAnswer != null)
                {
                    <a href="#quest-@i" class="menu-link">Câu @i <span class="tick" id="tick-@i">✓</span></a>
                }
                else
                {
                    <a href="#quest-@i" class="menu-link">Câu @i <span class="tick" id="tick-@i"></span></a>
                }
                i = i + 1;
            }
        }
    </div>
    <div class="testing-right">
        @{
            int x = 1;
            foreach (var item in list)
            {
                <div id="quest-@x" class="item-quest">
                    <div class="quest-title">Câu @x :</div>
                    <div class="quest-content">
                        <span>@item.Question.Content</span>
                    </div>
                    <div class="quest-answer">
                        <p>
                            <label>
                                @if (item.StudentTestDetail.StudentAnswer != null && item.StudentTestDetail.StudentAnswer.Trim().Equals(item.StudentTestDetail.AnswerA.Trim()))
                                {
                                    <input name="@item.Question.QuestionId" data-idquest="@item.Question.QuestionId" type="radio" data-stt="@x" value="@item.StudentTestDetail.AnswerA.Trim()" checked enabled />
                                }
                                else
                                {
                                    <input name="@item.Question.QuestionId" data-idquest="@item.Question.QuestionId" type="radio" data-stt="@x" value="@item.StudentTestDetail.AnswerA.Trim()" />
                                }
                                <span>@item.StudentTestDetail.AnswerA</span>
                            </label>
                        </p>
                        <p>
                            <label>
                                @if (item.StudentTestDetail.StudentAnswer != null && item.StudentTestDetail.StudentAnswer.Trim().Equals(item.StudentTestDetail.AnswerB.Trim()))
                                {
                                    <input name="@item.Question.QuestionId" data-idquest="@item.Question.QuestionId" type="radio" data-stt="@x" value="@item.StudentTestDetail.AnswerB.Trim()" checked enabled />
                                }
                                else
                                {
                                    <input name="@item.Question.QuestionId" data-idquest="@item.Question.QuestionId" type="radio" data-stt="@x" value="@item.StudentTestDetail.AnswerB.Trim()" />
                                }
                                <span>@item.StudentTestDetail.AnswerB</span>
                            </label>
                        </p>
                        <p>
                            <label>
                                @if (item.StudentTestDetail.StudentAnswer != null && item.StudentTestDetail.StudentAnswer.Trim().Equals(item.StudentTestDetail.AnswerC.Trim()))
                                {
                                    <input name="@item.Question.QuestionId" data-idquest="@item.Question.QuestionId" type="radio" data-stt="@x" value="@item.StudentTestDetail.AnswerC.Trim()" checked enabled />
                                }
                                else
                                {
                                    <input name="@item.Question.QuestionId" data-idquest="@item.Question.QuestionId" type="radio" data-stt="@x" value="@item.StudentTestDetail.AnswerC.Trim()" />
                                }
                                <span>@item.StudentTestDetail.AnswerC</span>
                            </label>
                        </p>
                        <p>
                            <label>
                                @if (item.StudentTestDetail.StudentAnswer != null && item.StudentTestDetail.StudentAnswer.Trim().Equals(item.StudentTestDetail.AnswerD.Trim()))
                                {
                                    <input name="@item.Question.QuestionId" data-idquest="@item.Question.QuestionId" type="radio" data-stt="@x" value="@item.StudentTestDetail.AnswerD.Trim()" checked enabled />
                                }
                                else
                                {
                                    <input name="@item.Question.QuestionId" data-idquest="@item.Question.QuestionId" type="radio" data-stt="@x" value="@item.StudentTestDetail.AnswerD.Trim()" />
                                }
                                <span>@item.StudentTestDetail.AnswerD</span>
                            </label>
                        </p>
                    </div>
                </div>
                x = x + 1;
            }
        }

        <a href="@Url.Action("SubmitTest")" class="btn flat" style="margin-left: 40%;width: 30%;margin-top: 20px;margin-bottom: 10px;" onclick="return confirm('Xác nhận nộp bài?')">Nộp Bài</a>
    </div>
</div>
<script>
     var min = @ViewBag.min;
    var sec = @ViewBag.sec;
    countdown();
    function countdown() {
            cdID = setInterval(function () {
                if (sec == 0) {
                    min--;
                    sec = 60;
                }
                sec--;
                if (min < 10 && min >0) {
                    $('#timer').css('color', 'red');
                    min_text = '0' + min;
                } else {
                    min_text = min;
                }
                if (sec < 10 && sec >0)
                    sec_text = '0' + sec;
                else
                    sec_text = sec;
                $('#timer').text(min_text + ':' + sec_text);
                if (min < 0 ) {
                    confirm('Hết giờ, hệ thống sẽ tự động nộp bài!');
                    window.location.replace("@Url.Action("SubmitTest")");
                }
            }, 1000);
    }
     $(function() {
         $('input[type=radio]').change(function() {
             var stt = $(this).data("stt");
             var idquest = $(this).data("idquest");
             var value = $(this).val();
             var data = {
                 id: idquest,
                 answer: value,
                 min: min,
                 sec: sec
             }
             var url = "@Url.Action("UpdateStudentTest")";
             var success = function(result) {
                 $('#tick-' + stt).text("✓");
             };
             $.post(url, data, success);
         });
     });
    $(window).scroll(function () {
        $('#footer').css("display", "none");
        if (window.pageYOffset > 30) {
            $('.testing-left').css("top", "65px").css("height", "calc(100% - 65px)");
            $('#timer').css("margin-top", "0px");
        }
        if (window.pageYOffset < 30) {
            $('.testing-left').css("top", "95px").css("height", "calc(100% - 95px)");
            $('#timer').css("margin-top", "30px");
        }
    });
    //jQuery for Page Scroll - Single page
    $('a[href*="#"]:not([href="#"])').click(function () {
        if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
            var target = $(this.hash);
            target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
            if (target.length) {
                $('html, body').animate({
                    scrollTop: target.offset().top - 65
                }, 500);
                return false;
            }
        }
    });
    window.onbeforeunload = function () {
        var url = "@Url.Action("UpdateTiming")"
        var data = {
            min: min,
            sec: sec
        }
        var success = function () {};
        $.post(url, data, success);
    }
</script>